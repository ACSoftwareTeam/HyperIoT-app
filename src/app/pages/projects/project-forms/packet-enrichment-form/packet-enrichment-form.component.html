<div id="container-enrichment-form" class="container">

  <div *ngIf="showCover && !editMode" class="row">

    <div id="container-add-enrich" class="col-12">

      <hyt-button (clickFn)="loadEmpty()">Add enrichment</hyt-button>

    </div>

  </div> <!-- END FIRST ROW -->

  <form [ngClass]="{ hidden: !editMode }" class="enrichment-form" [formGroup]="form" autocomplete="on">

    <div class="form-group row">

      <div 
        id="ffield-col-enrich-name" 
        class="col-tag-cat"
        [ngClass]="enrichmentType=='AddTagRuleAction' || enrichmentType=='AddCategoryRuleAction' ? 'col-4' : 'col-6'"
      > <!-- col-4 -->

        <hyt-input-text 
          [form]="form" formControlName="rule-name" name="rule-name" [isRequired]="true"
          i18n-placeholder="@@HYT_name" placeholder="HYT_name" [injectedErrorMsg]="getError('rule-name')"
          i18n-hintMessage="@@HYT_hint_rule_name"
          hintMessage="HYT_hint_rule_name"
        >
        </hyt-input-text>

      </div>

      <div 
        id="ffield-col-enrich-rules" 
        class="col-tag-cat"
        [ngClass]="enrichmentType=='AddTagRuleAction' || enrichmentType=='AddCategoryRuleAction' ? 'col-4' : 'col-6'"
      > <!-- col-4 -->

        <hyt-select 
          [form]="form" [options]="enrichmentRules" (changeFn)="enrichmentTypeChanged($event)"
          formControlName="enrichmentRule" name="enrichmentRule" [isRequired]="true" i18n-label="@@HYT_rule_type"
          label="HYT_rule_type">
        </hyt-select>
        
      </div>

      <div 
        *ngIf="enrichmentType=='AddTagRuleAction' || enrichmentType=='AddCategoryRuleAction'"
        id="ffield-col-enrich-tag-cat" 
        class="col-4 col-tag-cat" 
      >

        <hyt-asset-tag 
          *ngIf="enrichmentType=='AddTagRuleAction'" 
          [project]="project" 
          [packet]="packet"
          (tagIds)="updateAssetTag($event)">
        </hyt-asset-tag>

        <hyt-asset-category 
          *ngIf="enrichmentType=='AddCategoryRuleAction'" 
          [project]="project" 
          [packet]="packet"
          (categoryIds)="updateAssetCategory($event)">
        </hyt-asset-category>
        
      </div>

    </div> <!-- END FIRST FORM ROW -->

    <div class="form-group row">

      <div class="col-12">

        <hyt-text-area 
          [form]="form" formControlName="rule-description" name="rule-description"
          i18n-placeholder="@@HYT_description" placeholder="HYT_description"
          i18n-hintMessage="@@HYT_hint_rule_description"
          hintMessage="HYT_hint_rule_description">
        </hyt-text-area>

      </div>

    </div> <!-- END SECOND FORM ROW -->

    <div class="form-group row">

      <div class="col-12">

        <hyt-rule-definition 
          #ruleDef [currentPacket]="packet"
        >
        </hyt-rule-definition>

      </div>

    </div> <!-- END THIRD FORM ROW -->

    <div 
      *ngIf="loadingStatus !== LoadingStatus.Ready"
      class="overlay d-flex flex-column align-items-center justify-content-center"
    >
      <h4 *ngIf="loadingStatus === LoadingStatus.Loading" i18n="@@HYT_loading_data">HYT_loading_data</h4>
      <div *ngIf="loadingStatus === LoadingStatus.Error" class="d-flex flex-column justify-content-center">
        <h4 i18n="@@HYT_error_occurred">HYT_error_occurred</h4>
        <button mat-stroked-button (click)="loadingStatus = LoadingStatus.Ready">
          <span>Close</span>
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <h4 *ngIf="loadingStatus === LoadingStatus.Saving" i18n="@@HYT_saving_data">HYT_saving_data</h4>

      <mat-progress-bar *ngIf="loadingStatus === LoadingStatus.Loading || loadingStatus === LoadingStatus.Saving"
        mode="query"
      ></mat-progress-bar>

    </div>

  </form> <!-- END FORM -->

</div> <!-- END GENERAL CONTAINER -->

