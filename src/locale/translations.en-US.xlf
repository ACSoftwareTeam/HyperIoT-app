<?xml version="1.0" encoding="UTF-8" ?>
<xliff version="1.2" xmlns="urn:oasis:names:tc:xliff:document:1.2">
  <file source-language="en" datatype="plaintext" original="ng2.template">
    <body>
      <trans-unit id="HYT_username" datatype="html">
        <source>HYT_username</source>
        <target>Username</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/pages/authentication/login/login.component.html</context>
          <context context-type="linenumber">33</context>
        </context-group>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/pages/authentication/registration/registration.component.html</context>
          <context context-type="linenumber">43</context>
        </context-group>
      </trans-unit>
      <trans-unit id="HYT_password" datatype="html">
        <source>HYT_password</source>
        <target>Password</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/pages/authentication/login/login.component.html</context>
          <context context-type="linenumber">41</context>
        </context-group>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/pages/authentication/registration/registration.component.html</context>
          <context context-type="linenumber">55</context>
        </context-group>
      </trans-unit>
      <trans-unit id="HYT_registration" datatype="html">
        <source>HYT_registration</source>
        <target>Sign In</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/pages/authentication/registration/registration.component.html</context>
          <context context-type="linenumber">21</context>
        </context-group>
      </trans-unit>
      <trans-unit id="HYT_name" datatype="html">
        <source>HYT_name</source>
        <target>Name</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/pages/authentication/registration/registration.component.html</context>
          <context context-type="linenumber">31</context>
        </context-group>
      </trans-unit>
      <trans-unit id="HYT_surname" datatype="html">
        <source>HYT_surname</source>
        <target>Surname</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/pages/authentication/registration/registration.component.html</context>
          <context context-type="linenumber">37</context>
        </context-group>
      </trans-unit>
      <trans-unit id="HYT_email" datatype="html">
        <source>HYT_email</source>
        <target>Email</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/pages/authentication/registration/registration.component.html</context>
          <context context-type="linenumber">49</context>
        </context-group>
      </trans-unit>
      <trans-unit id="HYT_passwordConfirm" datatype="html">
        <source>HYT_passwordConfirm</source>
        <target>Confirm password</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/pages/authentication/registration/registration.component.html</context>
          <context context-type="linenumber">63</context>
        </context-group>
      </trans-unit>
      <trans-unit id="HYT_registration_button" datatype="html">
        <source>HYT_registration_button</source>
        <target>Sign In</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/pages/authentication/registration/registration.component.html</context>
          <context context-type="linenumber">81</context>
        </context-group>
      </trans-unit>
      <trans-unit id="HYT_registration_form_ok" datatype="html">
        <source>HYT_registration_form_ok</source>
        <target>Please click on the link that has just been sent to your email account to complete the registration process</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/pages/authentication/registration/registration.component.html</context>
          <context context-type="linenumber">85</context>
        </context-group>
      </trans-unit>
      <trans-unit id="6ab904593389e6b2cef07dbdd8176dfe41662bc1" datatype="html">
        <source>HYT_server_error_500</source>
        <target>Internal error</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/services/authentication-http-error-handler.service.ts</context>
          <context context-type="linenumber">1</context>
        </context-group>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/services/authentication-http-error-handler.service.ts</context>
          <context context-type="linenumber">1</context>
        </context-group>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/services/authentication-http-error-handler.service.ts</context>
          <context context-type="linenumber">1</context>
        </context-group>
      </trans-unit>
      <trans-unit id="a7ab86c6bc245dc3e54a80f23afb53728fab8167" datatype="html">
        <source>HYT_offline_504</source>
        <target>You seem to be offline. Please check your network connection</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/services/authentication-http-error-handler.service.ts</context>
          <context context-type="linenumber">1</context>
        </context-group>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/services/authentication-http-error-handler.service.ts</context>
          <context context-type="linenumber">1</context>
        </context-group>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/services/authentication-http-error-handler.service.ts</context>
          <context context-type="linenumber">1</context>
        </context-group>
      </trans-unit>
      <trans-unit id="a04ce575c9895b8cb4283b493a2703883520710a" datatype="html">
        <source>HYT_duplicate_entity</source>
        <target>already in use</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/services/authentication-http-error-handler.service.ts</context>
          <context context-type="linenumber">1</context>
        </context-group>
      </trans-unit>
      <trans-unit id="a48a62b370f07697e5532c369fa4e1e400f53b40" datatype="html">
        <source>HYT_unknown_error</source>
        <target>Error executing your request</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/services/authentication-http-error-handler.service.ts</context>
          <context context-type="linenumber">1</context>
        </context-group>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/services/authentication-http-error-handler.service.ts</context>
          <context context-type="linenumber">1</context>
        </context-group>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/services/authentication-http-error-handler.service.ts</context>
          <context context-type="linenumber">1</context>
        </context-group>
      </trans-unit>
      <trans-unit id="f8e19291bb0f5e04beab8ca91700587fe9d3b9b3" datatype="html">
        <source>HYT_wrong_user_or_password</source>
        <target>wrong username or password</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/services/authentication-http-error-handler.service.ts</context>
          <context context-type="linenumber">1</context>
        </context-group>
      </trans-unit>
      <trans-unit id="96b015a8cb3d48869109e5ce0b72af06d2bf9031" datatype="html">
        <source>HYT_field_required</source>
        <target>This field is mandatory</target>
        <context-group purpose="location">
          <context context-type="sourcefile">C:/Users/Gabriele Losiczko/HyperIoT/HyperIoT-component/projects/hyperiot-components/src/lib/hyt-input/hyt-input.component.ts</context>
          <context context-type="linenumber">1</context>
        </context-group>
      </trans-unit>
      <trans-unit id="caa12f28e24ab3f2fe27e9123a59c2e0aa5a57c6" datatype="html">
        <source>HYT_valid_email</source>
        <target>Please enter a valid email address</target>
        <context-group purpose="location">
          <context context-type="sourcefile">C:/Users/Gabriele Losiczko/HyperIoT/HyperIoT-component/projects/hyperiot-components/src/lib/hyt-input/hyt-input.component.ts</context>
          <context context-type="linenumber">1</context>
        </context-group>
      </trans-unit>
      <trans-unit id="33c9ece659dd5c0489ef586aae0136c6c480bb19" datatype="html">
        <source>HYT_min_length</source>
        <target>At least 8 character length</target>
        <context-group purpose="location">
          <context context-type="sourcefile">C:/Users/Gabriele Losiczko/HyperIoT/HyperIoT-component/projects/hyperiot-components/src/lib/hyt-input/hyt-input.component.ts</context>
          <context context-type="linenumber">1</context>
        </context-group>
      </trans-unit>
      <trans-unit id="099248b4e8ef7f4dfb63ac0a0815c387b95bf564" datatype="html">
        <source>HYT_min_one_number</source>
        <target>At least one number</target>
        <context-group purpose="location">
          <context context-type="sourcefile">C:/Users/Gabriele Losiczko/HyperIoT/HyperIoT-component/projects/hyperiot-components/src/lib/hyt-input/hyt-input.component.ts</context>
          <context context-type="linenumber">1</context>
        </context-group>
      </trans-unit>
      <trans-unit id="88e4d8c0ae5f7fb56559746c5f537ed55f114e4b" datatype="html">
        <source>HYT_upper_case</source>
        <target>At least one uppercase character</target>
        <context-group purpose="location">
          <context context-type="sourcefile">C:/Users/Gabriele Losiczko/HyperIoT/HyperIoT-component/projects/hyperiot-components/src/lib/hyt-input/hyt-input.component.ts</context>
          <context context-type="linenumber">1</context>
        </context-group>
      </trans-unit>
      <trans-unit id="e75c1bdd7a657e3e31ef4323632c18c18cc0db9e" datatype="html">
        <source>HYT_special_char</source>
        <target>At least one special character</target>
        <context-group purpose="location">
          <context context-type="sourcefile">C:/Users/Gabriele Losiczko/HyperIoT/HyperIoT-component/projects/hyperiot-components/src/lib/hyt-input/hyt-input.component.ts</context>
          <context context-type="linenumber">1</context>
        </context-group>
      </trans-unit>


      <trans-unit id="widgetsToolbar-title-play" datatype="html">
        <source>Play</source>
        <target>Riprendi</target>
        <context-group purpose="location">
          <context context-type="sourcefile">project/widgets/src/lib/common-toolbar/common-toolbar.component.html</context>
        </context-group>
      </trans-unit>
      <trans-unit id="widgetsToolbar-title-pause" datatype="html">
        <source>Pause</source>
        <target>Pausa</target>
        <context-group purpose="location">
          <context context-type="sourcefile">project/widgets/src/lib/common-toolbar/common-toolbar.component.html</context>
        </context-group>
      </trans-unit>
      <trans-unit id="widgetsToolbar-title-chartview" datatype="html">
        <source>Chart View</source>
        <target>Vista Grafico</target>
        <context-group purpose="location">
          <context context-type="sourcefile">project/widgets/src/lib/common-toolbar/common-toolbar.component.html</context>
        </context-group>
      </trans-unit>
      <trans-unit id="widgetsToolbar-title-tableview" datatype="html">
        <source>Table View</source>
        <target>Vista Tabella</target>
        <context-group purpose="location">
          <context context-type="sourcefile">project/widgets/src/lib/common-toolbar/common-toolbar.component.html</context>
        </context-group>
      </trans-unit>

      <trans-unit id="widgetsToolbar-title-settings" datatype="html">
        <source>Settings</source>
        <target>Impostazioni</target>
        <context-group purpose="location">
          <context context-type="sourcefile">project/widgets/src/lib/common-toolbar/common-toolbar.component.html</context>
        </context-group>
      </trans-unit>
      <trans-unit id="widgetsToolbar-title-refresh" datatype="html">
        <source>Refresh</source>
        <target>Aggiorna</target>
        <context-group purpose="location">
          <context context-type="sourcefile">project/widgets/src/lib/common-toolbar/common-toolbar.component.html</context>
        </context-group>
      </trans-unit>
      <trans-unit id="widgetsToolbar-title-close" datatype="html">
        <source>Close</source>
        <target>Chiudi</target>
        <context-group purpose="location">
          <context context-type="sourcefile">project/widgets/src/lib/common-toolbar/common-toolbar.component.html</context>
        </context-group>
      </trans-unit>
      <trans-unit id="widgetsToolbar-title-move" datatype="html">
        <source>Move</source>
        <target>Sposta</target>
        <context-group purpose="location">
          <context context-type="sourcefile">project/widgets/src/lib/common-toolbar/common-toolbar.component.html</context>
        </context-group>
      </trans-unit>
      <trans-unit id="widgetsCommon-msg-notconfigured" datatype="html">
        <source>Click 'Settings' button to configure.</source>
        <target>Premi il pulsante 'Impostazioni' per configurare il widget.</target>
      </trans-unit>
      <!-- HyperIoT-widgets test application -->
      <trans-unit id="addWidgetDialog-header" datatype="html">
        <source>Add Widget</source>
        <target>Aggiungi Widget</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/dashboard/add-widget-dialog/add-widget-dialog.component.html</context>
        </context-group>
      </trans-unit>
      <trans-unit id="addWidgetDialog-btn-add" datatype="html">
        <source>Add</source>
        <target>Aggiungi</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/dashboard/add-widget-dialog/add-widget-dialog.component.html</context>
        </context-group>
      </trans-unit>
      <trans-unit id="addWidgetDialog-btn-cancel" datatype="html">
        <source>Cancel</source>
        <target>Annulla</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/dashboard/add-widget-dialog/add-widget-dialog.component.html</context>
        </context-group>
      </trans-unit>
      <trans-unit id="dashboardButtonSave" datatype="html">
        <source>Save</source>
        <target>Salva</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/dashboard/dashboard-view/dashboard-view.component.html</context>
        </context-group>
      </trans-unit>
      <trans-unit id="widgetSettingsDialog-header" datatype="html">
        <source>Widget Settings</source>
        <target>Impostazioni Widget</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/dashboard/widget-settings-dialog/widget-settings-dialog.component.html</context>
        </context-group>
      </trans-unit>
      <trans-unit id="widgetSettingsDialog-lbl-name" datatype="html">
        <source>Name</source>
        <target>Nome</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/dashboard/widget-settings-dialog/widget-settings-dialog.component.html</context>
        </context-group>
      </trans-unit>
      <trans-unit id="widgetSettingsDialog-lbl-type" datatype="html">
        <source>Type</source>
        <target>Tipo</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/dashboard/widget-settings-dialog/widget-settings-dialog.component.html</context>
        </context-group>
      </trans-unit>
      <trans-unit id="widgetSettingsDialog-btn-apply" datatype="html">
        <source>Apply</source>
        <target>Applica</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/dashboard/widget-settings-dialog/widget-settings-dialog.component.html</context>
        </context-group>
      </trans-unit>
      <trans-unit id="widgetSettingsDialog-btn-cancel" datatype="html">
        <source>Cancel</source>
        <target>Annulla</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/dashboard/widget-settings-dialog/widget-settings-dialog.component.html</context>
        </context-group>
      </trans-unit>
      <trans-unit id="widgetSettingsDialog/packet-lbl-type" datatype="html">
        <source>Select packet</source>
        <target>Seleziona pacchetto</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/dashboard/widget-settings-dialog/packet-select/packet-select.component.html</context>
        </context-group>
      </trans-unit>
      <trans-unit id="widgetSettingsDialog/packet-lbl-fields" datatype="html">
        <source>Select {multiPacketSelect?1:0, plural, =0 {field} other {fields}}</source>
        <target>Seleziona {multiPacketSelect?1:0, plural, =0 {campo} other {campi}}</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/dashboard/widget-settings-dialog/packet-select/packet-select.component.html</context>
        </context-group>
      </trans-unit>
      <trans-unit id="widgetSettingsDialog/timechart-lbl-series" datatype="html">
        <source>Series title</source>
        <target>Titolo serie</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/dashboard/widget-settings-dialog/time-chart-settings/time-chart-settings.component.html</context>
        </context-group>
      </trans-unit>
      <trans-unit id="widgetSettingsDialog/statschart-lbl-series" datatype="html">
        <source>Series title</source>
        <target>Titolo serie</target>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/dashboard/widget-settings-dialog/stats-chart-settings/stats-chart-settings.component.html</context>
        </context-group>
      </trans-unit>
    </body>
  </file>
</xliff>



import { Component, OnInit, Input, ViewEncapsulation, ElementRef, ViewChild, OnDestroy } from '@angular/core';

import * as d3 from 'd3';

import { MonVarService } from '../services/mon-var.service';
import { ReactiveDataService } from '../services/reactive-data.service';
import { Curve } from '../models/Curve';
import { Variable } from '../models/Variable';
import { LoggerService, Logger } from '@alstom/services';
import { environment } from '../../../../environments/environment';
import { I18n } from '@ngx-translate/i18n-polyfill';

/**
 * VariableChartComponent is a component of SSysWeb.
 * VariableChartComponent allows to display a chart showing the values of a single variable in real time or with stored values. 
 * It stores the variable data for 30 minutes than it deletes the oldest data.
 * The line color can be changed with a color picker.
 */
@Component({
  selector: 'app-variable-chart',
  templateUrl: './variable-chart.component.html',
  styleUrls: ['./variable-chart.component.css'],
  encapsulation: ViewEncapsulation.None
})
export class VariableChartComponent implements OnInit, OnDestroy {

  /**
   * chartElement is the html element that will contain the chart
   */
  @ViewChild('chart') chartElement: ElementRef;

  /**
   * colorPicker is the color picker html element
   */
  @ViewChild('colorpicker') colorPicker: any;

  /**
   * input of 'VariableChartComponent' component.
   * variable is a Variable object. The chart is showing data of this variable
   */
  @Input() variable: Variable;

  /**
   * input of 'VariableChartComponent' component.
   * xDomain is the domain on the x axis.
   */
  @Input() xDomain;

  /**
   * input of 'VariableChartComponent' component.
   * dataId is a number. It tells if the value of the character need to be downloaded in real time or from the indexed database.
   * dataId == -1 if the variable data are online.
   * dataId >= 0 if the variable data need to be downloaded from the indexed database (with dataId as id).
   */
  @Input() dataId: number;

  /**
   * lineColor is the actual value line color.
   */
  lineColor: string = '#000';

  /**
   * curves is the array that stores all data.
   */
  curves: Curve[] = [];

  /**
   * connectionFailed is a boolean. It's false if the service to add a variable in a session returns an error.
   */
  connectionFailed = false;

  /**
   * This is a variable used to tap into the Logger class.
   */
  private logger: Logger;

  /**
   * Class constructor
   * @param monVarService 
   * @param dataService 
   */
  constructor(
    private monVarService: MonVarService,
    private dataService: ReactiveDataService,
    private loggerService: LoggerService,
    private i18n: I18n
  ) { }

  /**
   * A callback method that is invoked immediately after Angular has completed initialization of a component's view.
   * It asks to build the chart.
   */
  ngAfterViewInit() {
    this.buildChart();
  }

  /**
   * A callback method that is invoked immediately after the default change detector has checked the directive's data-bound properties for the first time, and before any of the view or content children have been checked.
   * It sets the line color and it loads the data that will be shown in the chart.
   */
  ngOnInit() {
    this.logger = new Logger(this.loggerService);
    this.logger.registerClass('VariableChartComponent');
    this.lineColor = this.variable.color;

    if (this.dataId < 0) {
      this.dataService.addVariable(this.variable.id).subscribe(
        res => { this.logger.debug('Adding variable:', res); this.loadReactiveData(); },
        err => { this.logger.error('Error! Unable to add variable', err); this.connectionFailed = true; this.loadReactiveData(); }
      )
    }
    else
      this.loadOfflineData();
  }

  /**
   * loadOfflineData() is called if the user is watching offline data.
   * It downloads all necessary data from the indexed database.
   */
  loadOfflineData() {
    var loadedData;
    this.monVarService.loadSpecificData(this.dataId).then(res => {
      this.curves = res.variableDataList.find(x => x.variable.id == this.variable.id).data;
      this.updateChart(this.xDomain);
    })
  }

  /**
   * loadReactiveData() is used if the user is watching real time data.
   * It downloads all necessary data in real time through kafka.
   */
  loadReactiveData() {
    this.dataService.subscribeReactive(this.variable.id).subscribe(
      res => {
        this.logger.debug('Real time vatiable-chart data:', res)
        if (res) {
          var curve = { timeStamp: new Date(res.timeStamp), value: res.value }
          this.curves.push(curve);
          while (this.curves[0].timeStamp.getTime() < (new Date(res.timeStamp)).getTime() - 30 * 60 * 1000)
            this.curves.shift();
        }
      },
      error => { this.logger.error('Error! Unable to add variable', error); this.connectionFailed = true; },
      () => {
      }
    )
  }

  /**
   * A callback method that performs custom clean-up, invoked immediately after a directive, pipe, or service instance is destroyed.
   * It callsdataService.deleteVariable() that asks the server to delete the current variable from the actual session.
   */
  ngOnDestroy(): void {
    if (this.dataId < 0) {
      this.dataService.deleteVariable(this.variable.id).subscribe(
        res => { },
        err => { }
      );
    }
  }

  /**
   * ax is the x property of the d3 chart
   */
  ax;

  /**
   * ay is the y property of the d3 chart
   */
  ay;

  /**
   * svg is the svg that contains all the d3 chart
   */
  svg;

  /**
   * contentWidth is the chart width
   */
  contentWidth = 1;

  /**
   * contentHeight is the chart height
   */
  contentHeight = 1;

  valueline = d3.line<Curve>()
    .x((d) => { return this.ax(d.timeStamp.getTime()); })
    .y((d) => { return this.ay(d.value); })
    .curve(d3.curveStepAfter)

  media = [];

  linePath;

  grid;

  /**
   * updateChart(domain) is called to update che chart with a specific x domain
   * This function updates the x gridlines and the value line.
   * @param domain 
   */
  updateChart(domain) {

    var t0 = performance.now();

    this.ax.domain(domain);

    var filtered = this.curves.filter(x => x.timeStamp.getTime() > domain[0].getTime() - 5000 && x.timeStamp.getTime() < domain[1].getTime() + 5000);

    this.grid
      .call(d3.axisBottom(this.ax).ticks(Math.floor(this.contentWidth / 75)).tickSize(-this.contentHeight))
      .selectAll("text, path.domain").remove();

    this.linePath
      .datum(filtered)
      .attr('d', this.valueline);

    var circle = this.svg.selectAll("circle").data(filtered)
    circle.exit().remove();
    circle.enter()
      .append("circle")
      .attr("clip-path", "url(#clip)")
      .style("fill", this.lineColor)
      .attr("r", 2.5)
      .attr("cx", (d) => { return this.ax(d.timeStamp.getTime()); })
      .attr("cy", (d) => { return this.ay(d.value); })
    circle
      .attr("cx", (d) => { return this.ax(d.timeStamp.getTime()); })
      .attr("cy", (d) => { return this.ay(d.value); })

      
      var t1 = performance.now();
      this.media.push(t1 - t0)
  
      var total = 0;
      for (var i = 0; i < this.media.length; i++) {
        total += this.media[i];
        console.log(this.media[i]);
      }
  
      if (this.media.length == 2000)
        alert(total / this.media.length)

  }

  /**
   * buildChart() is called to build the chart.
   * It sets the chart width, height, position, clipPath, x and y domain, the chart border 
   * and then it calls updateChart() to draw the x gridlines and the valueLine.
   */
  buildChart() {

    d3.select('#varChart' + this.variable.md5Id).remove();

    const element = this.chartElement.nativeElement;
    var margin = { top: 5, right: 20, bottom: 5, left: 20 }
    this.contentWidth = element.offsetWidth - margin.left - margin.right;
    this.contentHeight = 53 - margin.top - margin.bottom;

    this.ax = d3.scaleTime().range([0, this.contentWidth]);
    this.ay = d3.scaleLinear().range([this.contentHeight, 0]);

    this.svg = d3.select(element)
      .append('svg')
      .attr('id', 'varChart' + this.variable.md5Id)
      .attr('width', this.contentWidth + margin.left + margin.right)
      .attr('height', this.contentHeight + margin.top + margin.bottom)
      .append('g')
      .attr('transform', `translate(${margin.left},${margin.top})`);

    this.svg.append("defs").append("clipPath")
      .attr("id", "clip")
      .append("rect")
      .attr('transform', 'translate(0,-4)')
      .attr("width", this.contentWidth + 4)
      .attr("height", this.contentHeight + 8);

    this.ax.domain(this.xDomain);
    this.ay.domain([0, 1]);

    this.svg.append('line')
      .attr('x1', '0')
      .attr('y1', '0')
      .attr('x2', this.contentWidth)
      .attr('y2', '0')
      .style('stroke', 'lightgrey');

    this.svg.append('line')
      .attr('x1', '0')
      .attr('y1', this.contentHeight)
      .attr('x2', this.contentWidth)
      .attr('y2', this.contentHeight)
      .style('stroke', 'lightgrey');

    this.svg.append('line')
      .attr('x1', '0')
      .attr('y1', '0')
      .attr('x2', '0')
      .attr('y2', this.contentHeight)
      .style('stroke', 'lightgrey');

    this.svg.append('line')
      .attr('x1', this.contentWidth)
      .attr('y1', '0')
      .attr('x2', this.contentWidth)
      .attr('y2', this.contentHeight)
      .style('stroke', 'lightgrey');

    this.grid = this.svg.append('g')
      .attr('id', 'xGrid' + this.variable.md5Id)
      .attr('class', 'xGrid')
      .style("color", "lightgrey")
      .attr("transform", "translate(0," + this.contentHeight + ")")

    this.linePath = this.svg.append('path')
      .attr("id", "linePath" + this.variable.md5Id)
      .attr("clip-path", "url(#clip)")
      .style('stroke', this.lineColor)
      .style('fill', 'none');

    this.updateChart(this.xDomain);
  }

  /**
   * changeLinePathColor() is called from the color picker element. It sets the value line color
   */
  changeLinePathColor() {
    var lin = document.getElementById('linePath' + this.variable.md5Id);
    if (lin)
      lin.style.stroke = this.lineColor;
    var dots = document.getElementsByClassName('dot' + this.variable.md5Id);
    if (dots)
      for (let i = 0; i < dots.length; i++)
        dots[i].setAttribute('fill', this.lineColor)
  }
}
